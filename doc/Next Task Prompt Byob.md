### 📌 明日工作任務（2025-08-05）

**目標：優先解決 Google 表單資料對應問題，完成自動導入功能**

#### 1. 🚨 優先任務：Google 表單資料對應問題解決

**1.1 問題嚴重性評估**
* 🔴 **高優先級**：影響核心功能正常運作
* 🔴 **影響範圍**：5個重要欄位完全無資料對應
* 🔴 **用戶體驗**：前端顯示「暫無資料」，影響網站專業度

**1.2 詳細問題清單**

| 問題欄位 | Google 表單欄位 | WordPress ACF 欄位 | 當前狀態 | 影響程度 |
|----------|----------------|-------------------|----------|----------|
| 聯絡人 | 您的稱呼是？ | 聯絡人 | ❌ 空白 | 高 |
| 開瓶費政策 | 是否收開瓶費？ | 是否收開瓶費 | ❌ 暫無資料 | 高 |
| 開瓶費詳情 | 開瓶費金額/其他說明 | 開瓶費說明 | ❌ 暫無資料 | 中 |
| 酒器設備 | 是否提供酒器設備？ | 提供酒器設備 | ❌ 暫無資料 | 中 |
| 開酒服務 | 是否提供開酒服務？ | 是否提供開酒服務？ | ❌ 暫無資料 | 中 |

**1.3 系統性除錯計劃**

**階段 1：資料來源檢查（預計 2-3 小時）**
* [ ] 檢查 Google 表單實際欄位名稱
  - 確認是否有全形字符（？、：）
  - 檢查條件性欄位的實際名稱
  - 記錄每個欄位的完整名稱
* [ ] 檢查 Google 試算表資料格式
  - 確認資料是否正確寫入試算表
  - 檢查欄位標題行是否正確
  - 驗證最新提交的資料完整性

**階段 2：Apps Script 程式碼除錯（預計 3-4 小時）**
* [ ] 在關鍵位置加入除錯日誌
  ```javascript
  Logger.log('原始欄位名稱: ' + headerName);
  Logger.log('處理後欄位名稱: ' + processedName);
  Logger.log('欄位對應結果: ' + headerMap[processedName]);
  ```
* [ ] 檢查 `parseSpreadsheetData` 函數
  - 驗證 `headerMap` 建立邏輯
  - 檢查欄位名稱匹配算法
  - 確認條件性欄位處理邏輯
* [ ] 檢查 `toHalfWidth` 函數
  - 測試全形字符轉換
  - 驗證特殊字符處理
  - 確認空格處理邏輯

**階段 3：WordPress 端檢查（預計 2-3 小時）**
* [ ] 檢查 `functions.php` 中的 ACF 更新邏輯
  - 確認 `update_field` 函數參數
  - 檢查欄位名稱對應關係
  - 驗證資料類型處理
* [ ] 檢查 ACF 欄位設定
  - 確認欄位名稱是否正確
  - 檢查欄位類型設定
  - 驗證欄位權限設定

**階段 4：端到端測試（預計 2-3 小時）**
* [ ] 建立完整測試案例
  - 填寫所有欄位的測試表單
  - 記錄每個步驟的執行結果
  - 建立詳細的測試報告
* [ ] 驗證修正結果
  - 檢查 Apps Script 執行日誌
  - 驗證 WordPress 文章建立
  - 確認前端顯示正確

**1.4 預期解決方案**

**最可能的問題原因：**
1. **欄位名稱不匹配**（60% 機率）
   - Google 表單欄位名稱包含特殊字符
   - 條件性欄位的實際名稱與預期不符
2. **條件性欄位處理錯誤**（30% 機率）
   - 子層級欄位沒有正確處理
   - 邏輯判斷條件錯誤
3. **ACF 欄位設定問題**（10% 機率）
   - 欄位名稱或類型設定錯誤

**修正策略：**
1. **立即修正**：根據實際欄位名稱調整程式碼
2. **改善機制**：建立更穩健的錯誤處理
3. **預防措施**：建立自動化測試機制

#### 2. Google 表單自動導入 WordPress 流程完善

**2.1 當前狀態**
* ✅ WordPress 端：REST API 端點正常運作
* ✅ Google Apps Script：程式碼已實作並可執行
* ✅ 觸發器：已設定試算表觸發器，可自動處理表單提交
* ✅ 基本流程：Google 表單 → 試算表 → WordPress 文章建立成功
* ✅ 通知系統：成功發送通知郵件
* ❌ **關鍵問題：ACF 欄位資料對應不完整**

**2.2 成功對應的欄位（參考基準）**
- ✅ 餐廳名稱：Google 表單「餐廳名稱」→ WordPress 文章標題
- ✅ 地址：Google 表單「地址」→ WordPress ACF「地址」
- ✅ 餐廳聯絡電話：Google 表單「聯絡電話」→ WordPress ACF「餐廳聯絡電話」
- ✅ 餐廳類型：Google 表單「餐廳類型」→ WordPress ACF「餐廳類型」
- ✅ 官方網站/社群連結：Google 表單「餐廳網站或訂位連結」→ WordPress ACF「官方網站/社群連結」
- ✅ 備註說明：Google 表單「備註」→ WordPress ACF「備註說明」

**2.3 技術細節記錄**

**Google 表單欄位名稱（需要重新確認）：**
- 電子郵件
- 餐廳名稱
- 餐廳類型
- 行政區
- 地址
- 是否收開瓶費？ (答案：不收費、酌收、其他)
- 開瓶費金額（條件性顯示）
- 其他：請說明（條件性顯示）
- 是否提供酒器設備？
- 是否提供開酒服務？
- 聯絡電話
- 餐廳網站或訂位連結
- 餐廳 Instagram 或 Facebook
- 備註
- 您是餐廳負責人嗎？
- 您的稱呼是？

**WordPress ACF 欄位名稱（已確認）：**
- 餐廳圖片
- 地址
- Google map 地圖
- 電子郵件
- 餐廳聯絡電話
- 餐廳類型
- 是否收開瓶費
- 開瓶費說明
- 提供酒器設備
- 是否提供開酒服務？
- 開酒服務其他說明
- 官方網站/社群連結
- Google Maps 連結
- 備註說明
- 最後更新日期
- 資料來源/提供人
- 聯絡人

#### 3. 會員系統設計與實作（次要優先級）

**3.1 用戶會員系統**
* 設計用戶註冊/登入流程
* 建立用戶個人資料頁面
* 設計收藏餐廳功能
* 建立用戶評論系統
* 設計個人化推薦功能

**3.2 餐廳會員系統**
* 設計餐廳註冊/登入流程
* 建立餐廳管理後台
* 設計餐廳資訊更新功能
* 建立餐廳數據分析面板
* 設計餐廳與用戶互動功能

**3.3 會員權限管理**
* 設計不同會員等級權限
* 建立會員升級機制
* 設計 VIP 會員功能
* 建立積分/獎勵系統

#### 4. 資料格式一致性確認

**4.1 欄位對應檢查**
* 確認 Google 表單欄位與 ACF 欄位對應
* 確認 Apps Script 轉換邏輯正確
* 確認 WordPress 顯示格式統一

**4.2 複選欄位處理**
* 餐廳類型：最多三種，用「 / 」分隔
* 酒器設備：多選，用「、」分隔
* 開瓶費：單選，但需要處理子層級資訊
* 開酒服務：支援「其他」選項和說明

#### 5. 文件更新

**5.1 技術文件**
* 更新 ACF 欄位設定說明
* 記錄 PHP 檔案修改內容
* 建立 Google 表單匯入流程文件
* 建立會員系統設計文件

**5.2 操作手冊**
* 建立餐廳資料新增標準作業程序
* 建立故障排除指南
* 更新專案進度文件
* 建立會員系統使用說明

---

**今日已完成進度：**

* ✅ 完成 Contact 頁面設計和內容
* ✅ 設定 Contact Form 7 表單
* ✅ 安裝並設定 WP Mail SMTP 外掛
* ✅ 完成 Gmail SMTP 設定（byobmap.tw@gmail.com）
* ✅ 測試 Contact Form 7 郵件發送功能
* ✅ 設定 Contact Form 7 訊息內容
* ✅ 設計主頁面 FAQ 區塊（4個核心問題）
* ✅ 設計完整 FAQ 頁面（用戶 FAQ 10個、餐廳 FAQ 6個）
* ✅ 完成主頁面視覺設計和佈局
* ✅ 解決 Google Cloud OAuth 設定問題
* ✅ **新增：完成 Google 表單自動導入 WordPress 基本功能**
* ✅ **新增：建立 WordPress REST API 端點**
* ✅ **新增：實作 Google Apps Script 自動化程式**
* ✅ **新增：設定試算表觸發器和授權**
* ✅ **新增：完成基本流程測試（表單提交 → WordPress 文章建立）**
* ✅ **新增：建立通知郵件系統**
* ❌ **新增：發現 ACF 欄位資料對應不完整問題**

**明日重點（按優先級排序）：**

1. **🔴 最高優先級：解決 Google 表單資料對應問題**
   - 系統性除錯和修正
   - 建立完整的測試機制
   - 確保所有欄位正確對應

2. **🟡 中等優先級：完善 Google 表單自動導入功能**
   - 建立錯誤處理機制
   - 改善資料驗證邏輯
   - 建立監控系統

3. **🟢 低優先級：會員系統設計與實作**
   - 設計用戶和餐廳會員系統
   - 建立權限管理機制
   - 實作核心功能

4. **🟢 低優先級：文件更新**
   - 更新技術文件
   - 建立操作手冊
   - 記錄解決方案

**技術注意事項：**

* 🔴 **緊急**：Apps Script 欄位對應邏輯需要精確處理
* 🔴 **緊急**：WordPress ACF 欄位更新需要完整對應
* 🔴 **緊急**：需要建立詳細的除錯和測試機制
* 🟡 **重要**：保持資料格式一致性
* 🟡 **重要**：確保安全性處理（esc_html）
* 🟡 **重要**：測試複選欄位的邊界情況
* 🟢 **一般**：建立錯誤處理機制
* 🟢 **一般**：確保響應式設計效果
* 🟢 **一般**：Google 表單匯入流程需穩定可靠
* 🟢 **一般**：會員系統需考慮擴展性
* 🟢 **一般**：確保用戶資料安全性

**時間分配建議：**
- **上午（4小時）**：專注於資料對應問題的系統性除錯
- **下午（4小時）**：修正程式碼並進行端到端測試
- **晚上（2小時）**：文件更新和明日計劃制定

**成功標準：**
- [ ] 所有 Google 表單欄位都能正確對應到 WordPress ACF 欄位
- [ ] 條件性欄位能正確處理
- [ ] 複選欄位格式正確
- [ ] 空值處理適當
- [ ] 建立完整的測試案例
- [ ] 建立除錯和監控機制
- [ ] 更新相關文件
- [ ] 建立故障排除流程