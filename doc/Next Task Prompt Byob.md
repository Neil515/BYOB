# 🗓️ BYOB 專案 - 下次任務安排（2025-01-07）

## 📋 今日完成項目（2025-01-07）

### ✅ 已完成：
1. **第一階段：自定義 WooCommerce 會員選單（100% 完成）**
   - ✅ 隱藏不相關選單項目（訂單、下載次數、地址、Wishlist）
   - ✅ 移除重複的「餐廳控制台」選單項目
   - ✅ 建立專用選單結構：控制台 → 餐廳資料編輯 → 照片管理 → 菜單管理 → 登出
   - ✅ 完全覆蓋預設 WooCommerce 控制台內容
   - ✅ 餐廳業者專用控制台頁面建置完成

2. **第二階段：餐廳資料管理功能（重大進展）**
   - ✅ 餐廳資料編輯表單設計完成
   - ✅ LOGO 上傳功能程式碼完成
   - ✅ 表單驗證和提交處理完成
   - ✅ 建立 `restaurant-profile.php` WooCommerce 模板檔案
   - ✅ 上傳到伺服器 `/wp-content/themes/flatsome-child/woocommerce/myaccount/`
   - ✅ **解決 404 錯誤問題（100% 完成）**
   - ✅ **左側選單正常顯示**
   - ✅ **新增欄位正常顯示（餐廳類型、開瓶費、酒器設備、開酒服務、官方網站/社群連結）**

3. **程式碼優化**
   - ✅ 停用 YITH WooCommerce Wishlist 外掛
   - ✅ 簡化選單過濾器邏輯
   - ✅ 移除複雜的 Wishlist 隱藏程式碼
   - ✅ 優化快速操作按鈕樣式（使用 `rgba(139, 38, 53, 0.8)` 顏色）

---

## 🚨 今日遇到的問題（已解決）

### 1. **404 錯誤問題（✅ 已解決）**
**問題描述：** 所有選單項目（除了控制台和登出）都顯示 404 錯誤
**解決方案：** 使用 `template_include` 鉤子強制載入模板，並最終改用 `woocommerce_account_content` 鉤子

**解決過程：**
- ✅ 建立 WooCommerce 模板檔案
- ✅ 註冊自定義端點
- ✅ 重新整理永久連結
- ✅ 檢查檔案權限（664，正確）
- ✅ 使用 `template_include` 鉤子強制載入（解決404，但左側選單消失）
- ✅ 改用 `woocommerce_account_content` 鉤子（最終解決方案）

**最終解決方案：**
```php
function byob_load_restaurant_profile_content() {
    global $wp_query;
    
    if (is_account_page() && isset($wp_query->query_vars['restaurant-profile'])) {
        remove_action('woocommerce_account_content', 'woocommerce_account_content', 10);
        
        $template_path = get_stylesheet_directory() . '/woocommerce/myaccount/restaurant-profile.php';
        
        if (file_exists($template_path)) {
            include $template_path;
        }
    }
}

add_action('woocommerce_account_content', 'byob_load_restaurant_profile_content', 5);
```

### 2. **左側選單消失問題（✅ 已解決）**
**問題描述：** 使用 `template_include` 鉤子後，左側選單消失
**解決方案：** 改用 `woocommerce_account_content` 鉤子，只替換內容區域，保持頁面結構完整

### 3. **重複內容區塊問題（✅ 已解決）**
**問題描述：** 頁面出現上下兩個編輯區塊
**解決方案：** 使用 `remove_action` 移除 WooCommerce 預設內容，使用優先級 5 確保在預設內容之前執行

---

## 🎯 下次任務：完善餐廳資料編輯頁面

### 🔴 最高優先級：ACF 資料完整帶入

#### 1. 檢查 ACF 欄位資料載入（預計 1 小時）
**目標：** 確保所有新增欄位能正確顯示已儲存的資料

**實作內容：**
- [ ] **檢查 ACF 欄位資料載入**
  - 確認 `restaurant_type` 欄位資料正確顯示
  - 確認 `is_charged` 欄位資料正確顯示
  - 確認 `corkage_fee` 欄位資料正確顯示
  - 確認 `equipment` 欄位資料正確顯示
  - 確認 `open_bottle_service` 欄位資料正確顯示
  - 確認 `website` 欄位資料正確顯示
  - 確認 `social_links` 欄位資料正確顯示

- [ ] **測試資料載入功能**
  - 在餐廳文章草稿中填入測試資料
  - 檢查餐廳資料編輯頁面是否正確顯示
  - 驗證 checkbox 和 radio button 的選中狀態

#### 2. 修正 ACF 欄位資料載入問題（預計 1.5 小時）
**目標：** 解決任何資料載入不正確的問題

**實作內容：**
- [ ] **檢查 `get_field()` 函數調用**
  - 確認 ACF 外掛已啟用
  - 檢查欄位名稱是否正確
  - 驗證欄位類型設定

- [ ] **修正資料顯示邏輯**
  - 修正 checkbox 陣列資料的顯示邏輯
  - 修正 radio button 資料的顯示邏輯
  - 確保空值不會造成錯誤

### 🟡 中等優先級：細部修改餐廳資料編輯頁面

#### 3. 表單樣式和佈局優化（預計 1 小時）
**目標：** 改善表單的外觀和用戶體驗

**實作內容：**
- [ ] **表單佈局優化**
  - 調整欄位間距和對齊
  - 改善響應式設計
  - 優化 checkbox 和 radio button 的排列

- [ ] **樣式一致性**
  - 統一所有欄位的樣式
  - 改善 hover 和 focus 狀態
  - 優化按鈕樣式和互動效果

#### 4. 表單驗證和錯誤處理（預計 1 小時）
**目標：** 改善表單的驗證和錯誤提示

**實作內容：**
- [ ] **前端驗證優化**
  - 改善 checkbox 數量限制的提示
  - 添加必填欄位的視覺提示
  - 優化表單提交前的驗證

- [ ] **後端錯誤處理**
  - 改善錯誤訊息的顯示
  - 添加成功更新的確認訊息
  - 優化 LOGO 上傳的錯誤處理

#### 5. 功能測試和除錯（預計 0.5 小時）
**目標：** 確保所有功能正常運作

**測試項目：**
- [ ] **表單提交功能**
  - 測試所有欄位的資料儲存
  - 驗證 LOGO 上傳功能
  - 檢查資料更新後的顯示

- [ ] **用戶體驗測試**
  - 測試表單的易用性
  - 檢查錯誤處理的用戶友好性
  - 驗證響應式設計

---

## 🛠️ 技術實作重點

### 📁 需要檢查的檔案：
1. `restaurant-profile.php` - 檢查 ACF 欄位資料載入
2. `restaurant-member-functions.php` - 檢查表單提交處理
3. `functions.php` - 確認內容載入鉤子正常運作

### 🔧 需要解決的技術問題：
1. **ACF 欄位資料載入**
   - 確認 `get_field()` 函數正確調用
   - 檢查欄位名稱和類型設定
   - 驗證資料顯示邏輯

2. **表單樣式和佈局**
   - 優化響應式設計
   - 改善用戶體驗
   - 統一視覺風格

3. **表單驗證和錯誤處理**
   - 前端驗證優化
   - 後端錯誤處理改善
   - 用戶友好的提示訊息

### 📊 預期成果：
1. ✅ 所有 ACF 欄位資料正確載入和顯示
2. ✅ 表單樣式和佈局優化完成
3. ✅ 表單驗證和錯誤處理改善
4. ✅ 用戶體驗顯著提升

---

## 📝 工作流程

### 上午（9:00-12:00）：
1. 檢查 ACF 欄位資料載入問題
2. 修正資料顯示邏輯

### 下午（13:00-17:00）：
1. 表單樣式和佈局優化
2. 表單驗證和錯誤處理改善
3. 功能測試和除錯

---

## 🚨 注意事項

1. **優先解決資料載入問題**：確保所有新增欄位能正確顯示已儲存資料
2. **保持現有功能正常**：不要破壞已經解決的 404 和選單問題
3. **逐步優化**：每次修改後都要測試，確保功能正常
4. **記錄修改過程**：詳細記錄每個問題的解決方法，方便後續維護

---

## 🔍 問題診斷清單

### ACF 資料載入檢查：
- [ ] **餐廳類型欄位**
  - [ ] 確認 `restaurant_type` 欄位名稱正確
  - [ ] 檢查 checkbox 選中狀態是否正確
  - [ ] 驗證陣列資料的處理邏輯

- [ ] **開瓶費相關欄位**
  - [ ] 確認 `is_charged` 欄位名稱正確
  - [ ] 檢查 radio button 選中狀態
  - [ ] 確認 `corkage_fee` 欄位資料顯示

- [ ] **酒器設備欄位**
  - [ ] 確認 `equipment` 欄位名稱正確
  - [ ] 檢查 checkbox 選中狀態
  - [ ] 驗證陣列資料的處理邏輯

- [ ] **其他欄位**
  - [ ] 確認 `open_bottle_service` 欄位資料
  - [ ] 確認 `website` 欄位資料
  - [ ] 確認 `social_links` 欄位資料

### 表單功能測試：
- [ ] **資料顯示**
  - [ ] 所有欄位正確顯示已儲存資料
  - [ ] 空值欄位不會造成錯誤
  - [ ] 特殊字元正確顯示

- [ ] **表單提交**
  - [ ] 所有欄位資料正確儲存
  - [ ] LOGO 上傳功能正常
  - [ ] 成功/失敗訊息正確顯示

- [ ] **用戶體驗**
  - [ ] 表單佈局美觀易用
  - [ ] 響應式設計正常
  - [ ] 錯誤處理用戶友好

---

## 📊 進度總結

### 已完成階段：
- ✅ **第一階段：自定義 WooCommerce 會員選單（100%）**
- ✅ **第二階段：餐廳資料管理功能（80%）**
  - ✅ 404 錯誤解決（100%）
  - ✅ 左側選單正常顯示（100%）
  - ✅ 新增欄位正常顯示（100%）
  - ⏳ ACF 資料完整帶入（待完成）
  - ⏳ 細部修改和優化（待完成）

### 下次重點：
1. **ACF 資料完整帶入** - 確保所有新增欄位能正確顯示已儲存資料
2. **表單優化** - 改善樣式、佈局和用戶體驗
3. **功能完善** - 完善驗證、錯誤處理和響應式設計

---

*最後更新：2025-01-07*
*負責人：[您的姓名]*
*下次重點：完善餐廳資料編輯頁面，確保 ACF 資料正確載入和顯示*