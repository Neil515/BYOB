# 🗓️ BYOB 專案 - 明日任務安排（2025-08-14）

## 📋 今日完成項目（2025-08-13）

### ✅ 已完成：
1. **第一階段：自定義 WooCommerce 會員選單（100% 完成）**
   - ✅ 隱藏不相關選單項目（訂單、下載次數、地址、Wishlist）
   - ✅ 移除重複的「餐廳控制台」選單項目
   - ✅ 建立專用選單結構：控制台 → 餐廳資料編輯 → 照片管理 → 菜單管理 → 登出
   - ✅ 完全覆蓋預設 WooCommerce 控制台內容
   - ✅ 餐廳業者專用控制台頁面建置完成

2. **第二階段：餐廳資料管理功能（部分完成）**
   - ✅ 餐廳資料編輯表單設計完成
   - ✅ LOGO 上傳功能程式碼完成
   - ✅ 表單驗證和提交處理完成
   - ✅ 建立 `restaurant-profile.php` WooCommerce 模板檔案
   - ✅ 上傳到伺服器 `/wp-content/themes/flatsome-child/woocommerce/myaccount/`

3. **程式碼優化**
   - ✅ 停用 YITH WooCommerce Wishlist 外掛
   - ✅ 簡化選單過濾器邏輯
   - ✅ 移除複雜的 Wishlist 隱藏程式碼
   - ✅ 優化快速操作按鈕樣式（使用 `rgba(139, 38, 53, 0.8)` 顏色）

---

## 🚨 今日遇到的問題

### 1. **404 錯誤問題（未解決）**
**問題描述：** 所有選單項目（除了控制台和登出）都顯示 404 錯誤
**影響範圍：** 餐廳資料編輯、照片管理、菜單管理頁面

**已嘗試的解決方案：**
- ✅ 建立 WooCommerce 模板檔案
- ✅ 註冊自定義端點
- ✅ 重新整理永久連結
- ✅ 檢查檔案權限（664，正確）

**問題分析：**
- 檔案已正確上傳到伺服器
- 位置：`/wp-content/themes/flatsome-child/woocommerce/myaccount/restaurant-profile.php`
- 權限：664（正確）
- 檔案大小：10,868 位元組（正確）

### 2. **WordPress 系統狀態問題**
**發現的問題：**
- ❌ **REST API 錯誤**：`cURL error 28: Operation timed out after 10000 milliseconds`
- ❌ **PHP 工作階段問題**：已偵測到執行中的 PHP 工作階段
- ❌ **Jetpack 連線測試**：可能有連線問題

**影響分析：**
- REST API 超時可能影響端點註冊
- 重寫規則無法正確載入
- 新建立的頁面無法被 WordPress 識別

### 3. **404 錯誤根本原因分析（新增）**
**經過程式碼分析，發現五個可能原因，按機率排序：**

#### **原因 1：端點註冊函數未執行（最高機率 80%）**
**問題描述：** `byob_register_restaurant_endpoints()` 函數可能沒有被正確調用
**檢測方法：** 在錯誤日誌中加入診斷訊息，檢查函數執行狀態
**影響：** WordPress 不知道要新增這些新頁面

#### **原因 2：函數衝突或重複註冊（高機率 70%）**
**問題描述：** 在兩個地方都註冊了相同的端點，可能造成衝突
**檢測方法：** 檢查是否有重複的 `add_rewrite_endpoint()` 調用
**影響：** 後註冊的端點覆蓋了先註冊的

#### **原因 3：WooCommerce 模板載入順序問題（中高機率 60%）**
**問題描述：** `restaurant-profile.php` 檔案存在但 WooCommerce 無法正確載入
**檢測方法：** 檢查主題的 `functions.php` 是否正確載入我們的函數檔案
**影響：** 模板檔案無法被識別

#### **原因 4：權限檢查失敗（中等機率 50%）**
**問題描述：** 使用者角色檢查或餐廳關聯檢查失敗
**檢測方法：** 檢查使用者是否為 `restaurant_owner` 角色
**影響：** 頁面載入但顯示權限不足

#### **原因 5：REST API 超時影響（中等機率 40%）**
**問題描述：** REST API 問題影響了端點註冊或 WooCommerce 運作
**檢測方法：** 檢查 REST API 回應時間和錯誤日誌
**影響：** 系統層級的問題影響所有新功能

---

## 🎯 明日任務：解決 404 問題並完成第二階段

### 🔴 最高優先級：解決 404 錯誤

#### 1. 診斷和解決 404 錯誤根本原因（預計 2.5 小時）
**目標：** 系統性診斷五個可能原因，找出 404 錯誤的根源

**實作內容：**
- [ ] **原因 1：端點註冊函數未執行（最高優先級）**
  - 在 `restaurant-member-functions.php` 中加入診斷日誌
  - 檢查 `byob_init_restaurant_member_system()` 是否被調用
  - 檢查 `byob_register_restaurant_endpoints()` 是否執行
  - 驗證端點註冊是否成功

- [ ] **原因 2：函數衝突或重複註冊**
  - 檢查是否有重複的 `add_rewrite_endpoint()` 調用
  - 移除重複的端點註冊程式碼
  - 統一端點註冊邏輯

- [ ] **原因 3：WooCommerce 模板載入問題**
  - 檢查主題的 `functions.php` 是否正確載入函數檔案
  - 確認模板檔案路徑和權限
  - 測試 WooCommerce 模板載入機制

- [ ] **原因 4：權限檢查失敗**
  - 檢查使用者角色設定
  - 驗證餐廳關聯邏輯
  - 測試權限檢查流程

- [ ] **原因 5：REST API 超時影響**
  - 檢查伺服器連線狀態
  - 診斷 REST API 超時問題
  - 確認 PHP 工作階段設定

#### 2. 建立剩餘的 WooCommerce 模板檔案（預計 1.5 小時）
**目標：** 完成所有必要的頁面模板

**實作內容：**
- [ ] **建立 `restaurant-photos.php`**
  - 照片上傳介面
  - 照片排序功能
  - 照片刪除功能

- [ ] **建立 `restaurant-menu.php`**
  - 菜單管理介面
  - 菜單項目編輯
  - 菜單排序功能

### 🟡 中等優先級：功能測試和優化

#### 3. 測試所有功能（預計 1 小時）
**目標：** 確保所有頁面功能正常運作

**測試項目：**
- [ ] **餐廳資料編輯頁面**
  - 表單正常顯示
  - 資料編輯功能
  - LOGO 上傳功能
  - 表單提交和驗證

- [ ] **照片管理頁面**
  - 頁面正常顯示
  - 基本功能運作

- [ ] **菜單管理頁面**
  - 頁面正常顯示
  - 基本功能運作

#### 4. 錯誤處理和用戶體驗優化（預計 0.5 小時）
**目標：** 改善錯誤處理和用戶體驗

**實作內容：**
- [ ] **404 錯誤處理**
  - 自定義 404 頁面
  - 用戶友好的錯誤訊息
  - 返回選單的導航連結

- [ ] **載入狀態優化**
  - 頁面載入指示器
  - 錯誤重試機制

---

## 🛠️ 技術實作重點

### 📁 需要檢查的檔案：
1. `restaurant-member-functions.php` - 確認端點註冊函數
2. `restaurant-profile.php` - 已建立，需要測試
3. `restaurant-photos.php` - 需要建立
4. `restaurant-menu.php` - 需要建立

### 🔧 需要解決的技術問題：
1. **端點註冊函數未執行（最高優先級）**
   - 檢查 `byob_init_restaurant_member_system()` 是否被調用
   - 驗證 `byob_register_restaurant_endpoints()` 執行狀態
   - 在錯誤日誌中加入診斷訊息

2. **函數衝突或重複註冊**
   - 檢查重複的 `add_rewrite_endpoint()` 調用
   - 統一端點註冊邏輯
   - 移除衝突的程式碼

3. **WooCommerce 模板載入問題**
   - 檢查主題 functions.php 載入順序
   - 確認模板檔案路徑正確性
   - 測試模板載入機制

4. **權限檢查失敗**
   - 檢查使用者角色設定
   - 驗證餐廳關聯邏輯
   - 測試權限檢查流程

5. **REST API 超時影響**
   - 檢查伺服器連線狀態
   - 診斷 API 回應時間
   - 確認 PHP 工作階段設定

### 📊 預期成果：
1. ✅ 所有選單項目不再顯示 404 錯誤
2. ✅ 餐廳資料編輯頁面正常顯示和運作
3. ✅ 照片管理和菜單管理頁面建立完成
4. ✅ WordPress 系統狀態問題解決

---

## 📝 工作流程

### 上午（9:00-12:00）：
1. 診斷和解決系統問題（REST API、重寫規則）
2. 測試端點註冊和頁面顯示

### 下午（13:00-17:00）：
1. 建立剩餘的 WooCommerce 模板檔案
2. 測試所有功能
3. 優化錯誤處理和用戶體驗

---

## 🚨 注意事項

1. **優先解決系統問題**：404 錯誤的根本原因是系統狀態問題，需要先解決
2. **不要修改已完成的程式碼**：第一階段的程式碼已經完成，問題在於系統層級
3. **逐步測試**：每解決一個問題就測試一次，確保進度
4. **記錄解決過程**：詳細記錄每個問題的解決方法，方便後續維護

---

## 🔍 問題診斷清單

### 404 錯誤根本原因診斷（按優先級排序）：
- [ ] **原因 1：端點註冊函數未執行（最高優先級）**
  - [ ] 檢查 `byob_init_restaurant_member_system()` 是否被調用
  - [ ] 檢查 `byob_register_restaurant_endpoints()` 是否執行
  - [ ] 在錯誤日誌中加入診斷訊息
  - [ ] 驗證端點註冊是否成功

- [ ] **原因 2：函數衝突或重複註冊**
  - [ ] 檢查是否有重複的 `add_rewrite_endpoint()` 調用
  - [ ] 移除重複的端點註冊程式碼
  - [ ] 統一端點註冊邏輯

- [ ] **原因 3：WooCommerce 模板載入問題**
  - [ ] 檢查主題的 `functions.php` 是否正確載入函數檔案
  - [ ] 確認模板檔案路徑和權限
  - [ ] 測試 WooCommerce 模板載入機制

- [ ] **原因 4：權限檢查失敗**
  - [ ] 檢查使用者角色設定
  - [ ] 驗證餐廳關聯邏輯
  - [ ] 測試權限檢查流程

- [ ] **原因 5：REST API 超時影響**
  - [ ] 檢查伺服器連線狀態
  - [ ] 診斷 REST API 超時問題
  - [ ] 確認 PHP 工作階段設定

### 系統層級檢查：
- [ ] 伺服器連線狀態
- [ ] REST API 回應時間
- [ ] PHP 工作階段設定
- [ ] `.htaccess` 檔案權限
- [ ] mod_rewrite 模組狀態

### WordPress 層級檢查：
- [ ] 端點註冊函數執行
- [ ] 重寫規則載入
- [ ] 模板檔案識別
- [ ] 權限設定正確性

---

*最後更新：2025-01-07*
*負責人：[您的姓名]*
*明日重點：解決 404 錯誤，完成第二階段餐廳資料管理功能*