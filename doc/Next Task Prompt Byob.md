# 🍷 BYOB 專案工作規劃與進度追蹤

## 📅 當前日期：2025年8月29日

## 🚀 已完成任務

### ✅ 核心功能開發
- [x] 餐廳類型「其他」選項資料傳遞問題解決
- [x] 開瓶費欄位分離和前台顯示修正
- [x] 餐廳資料編輯頁面樣式優化
- [x] 餐廳直接加入頁面基礎架構開發

### ✅ 餐廳直接加入頁面開發 ⭐ 重大突破

**8月27日完成工作：**
- [x] 解決 Flatsome 主題相容性問題：將功能整合到 `functions.php` 中
- [x] 建立 Flatsome 相容的餐廳註冊表單短代碼：`[flatsome_byob_restaurant_registration_form]`
- [x] 實作基本的表單欄位：餐廳名稱、聯絡人姓名、聯絡電話、餐廳地址、餐廳Email、密碼
- [x] 建立基本的 AJAX 處理邏輯和資料驗證
- [x] 解決網站嚴重錯誤問題，表單正常顯示
- [x] **解決 ACF 欄位空白問題** ⭐ 核心突破

**8月29日完成工作：**
- [x] **密碼規則說明和驗證機制實作** ⭐ 今日重大突破
  - [x] 新增確認密碼欄位
  - [x] 實作密碼顯示/隱藏功能
  - [x] 實作密碼強度檢查
  - [x] 實作密碼匹配檢查
  - [x] 加入密碼規則說明區塊
  - [x] 前端和後端雙重密碼驗證
- [x] **Email 重複檢查功能實作** ⭐ 用戶體驗改善
  - [x] 即時 Email 可用性檢查
  - [x] 詳細錯誤訊息顯示（「用戶建立失敗 (原因：此Email已註冊)」）
  - [x] 前端 Email 格式驗證
  - [x] 後端 Email 重複驗證
- [x] **頁面樣式優化** ⭐ 視覺改善
  - [x] 修改註冊按鈕顏色為 `rgba(139, 38, 53, 0.7)`
  - [x] 修改密碼規則欄左邊粗線條顏色
  - [x] 移除密碼規則說明中的版本標示
- [x] **頁面結構優化** ⭐ 架構改善
  - [x] 刪除 `page-restaurant-join-us.php` 中的頁面標題和描述
  - [x] 簡化頁面結構，避免與 Hero 重複

**ACF 欄位問題解決過程：**
- **問題根源**：`restaurant-direct-join.php` 檔案沒有被載入，且 `functions.php` 中的餐廳建立函數缺少 ACF 欄位更新功能
- **解決方案**：在 `functions.php` 中直接整合 ACF 欄位更新邏輯，確保餐廳建立後正確儲存所有表單資料
- **技術要點**：使用 `update_field()` 函數更新 ACF 欄位，設定餐廳與用戶的關聯

**相關檔案：**
- `wordpress/functions.php`：已整合餐廳直接加入功能、密碼驗證、Email 檢查
- 短代碼：`[flatsome_byob_restaurant_registration_form]`
- `wordpress/page-restaurant-join-us.php`：簡化的頁面模板

## 🔴 下個階段工作重點

### 🚨 優先級 1：Google Maps API 地址驗證功能 ⭐ 下階段重點

**需求描述：**
實作「Google Maps API + 前端即時驗證」的地址驗證組合，提升地址輸入的準確性和用戶體驗。

**功能需求：**
1. **前端即時驗證**：使用 Google Places Autocomplete 提供地址建議
2. **後端地址驗證**：使用 Google Geocoding API 驗證地址有效性
3. **地址標準化**：統一地址格式
4. **地圖預覽**：顯示地址在地圖上的位置

**技術實作要點：**
1. **Google Places Autocomplete**：前端即時地址建議
2. **Google Geocoding API**：後端地址驗證
3. **地址格式標準化**：統一地址顯示格式
4. **API 金鑰管理**：安全地管理 Google Maps API 金鑰
5. **成本控制**：設定 API 調用限制，避免超支

### 🚨 優先級 2：餐廳前台頁面顯示機制 ⭐ 下階段重點

**需求描述：**
建立餐廳前台頁面的顯示機制，確保只有完成特定必要欄位的餐廳才會顯示在前台頁面。

**功能需求：**
1. **必要欄位檢查**：定義餐廳顯示的必要欄位清單
2. **顯示條件邏輯**：實作餐廳顯示的條件判斷
3. **前台頁面過濾**：在餐廳列表和單一餐廳頁面實作過濾機制
4. **管理員通知**：通知管理員哪些餐廳因資料不完整而無法顯示
5. **業者提醒**：提醒業者完成必要欄位以顯示餐廳

**必要欄位定義（建議）：**
- [ ] 餐廳名稱（必填）
- [ ] 聯絡人姓名（必填）
- [ ] 聯絡電話（必填）
- [ ] 餐廳地址（必填）
- [ ] 餐廳類型（必填）
- [ ] 行政區（必填）
- [ ] 開瓶費政策（必填）
- [ ] 基本營業資訊（建議）

**技術實作要點：**
1. **資料庫查詢過濾**：在查詢餐廳時加入顯示條件
2. **前台頁面修改**：修改 `archive-restaurant.php` 和 `single_restaurant.php`
3. **管理員介面**：在後台顯示餐廳完成度統計
4. **業者提醒系統**：在餐廳編輯頁面顯示完成度提醒

## 📋 下階段工作清單

### 🔴 優先級 1：Google Maps API 地址驗證功能 ⭐ 下階段重點

**第一階段：API 設定和基礎功能**
- [ ] 申請和設定 Google Maps API 金鑰
- [ ] 實作前端 Google Places Autocomplete 功能
- [ ] 實作後端 Google Geocoding API 驗證
- [ ] 設定 API 調用限制和成本控制

**第二階段：功能整合**
- [ ] 整合地址驗證到餐廳註冊表單
- [ ] 整合地址驗證到餐廳編輯頁面
- [ ] 實作地址格式標準化功能
- [ ] 實作地圖預覽功能

**第三階段：測試和優化**
- [ ] 測試地址驗證的準確性和用戶體驗
- [ ] 優化 API 調用效率
- [ ] 實作錯誤處理和回退機制
- [ ] 測試不同地區的地址驗證

### 🟡 優先級 2：餐廳前台頁面顯示機制 ⭐ 下階段重點

**第一階段：必要欄位定義和檢查邏輯**
- [ ] 定義餐廳顯示的必要欄位清單
- [ ] 實作必要欄位檢查函數
- [ ] 建立餐廳完成度計算邏輯
- [ ] 實作顯示條件判斷機制

**第二階段：前台頁面修改**
- [ ] 修改 `archive-restaurant.php` 加入過濾邏輯
- [ ] 修改 `single_restaurant.php` 加入顯示條件
- [ ] 實作餐廳列表的過濾顯示
- [ ] 實作單一餐廳頁面的顯示控制

**第三階段：管理員和業者介面**
- [ ] 在後台建立餐廳完成度統計頁面
- [ ] 實作管理員通知機制
- [ ] 在餐廳編輯頁面加入完成度提醒
- [ ] 實作業者完成度進度條

## 🎯 成功標準

### Google Maps API 地址驗證功能 ⭐ 下階段重點
- [ ] 前端地址輸入提供即時建議和自動完成
- [ ] 後端地址驗證確保地址有效性和準確性
- [ ] 地址格式統一標準化，提升資料品質
- [ ] API 調用成本控制在合理範圍內
- [ ] 地址驗證功能整合到註冊和編輯頁面

### 餐廳前台頁面顯示機制 ⭐ 下階段重點
- [ ] 只有完成必要欄位的餐廳才會顯示在前台
- [ ] 管理員可以清楚看到餐廳完成度統計
- [ ] 業者可以清楚知道需要完成哪些欄位
- [ ] 前台頁面顯示品質大幅提升
- [ ] 用戶體驗更加一致和專業

## 📝 技術筆記

### 今日解決的關鍵技術點

**密碼驗證機制實作：**
1. **前端驗證**：JavaScript 實作密碼強度檢查和匹配驗證
2. **後端驗證**：PHP 實作密碼長度和強度驗證
3. **用戶體驗**：即時視覺回饋和錯誤訊息
4. **安全性**：前端和後端雙重驗證保障

**Email 重複檢查功能：**
1. **即時檢查**：AJAX 實作 Email 可用性檢查
2. **錯誤處理**：詳細的錯誤訊息顯示
3. **防抖動機制**：500ms 延遲避免過於頻繁的請求
4. **視覺回饋**：即時顯示檢查結果

**Flatsome 主題相容性：**
1. **函數命名策略**：使用 `flatsome_byob_` 前綴避免衝突
2. **檔案整合**：直接整合到 `functions.php` 確保相容性
3. **樣式處理**：使用內聯樣式避免 CSS 類別問題

### 下階段工作技術要點

**Google Maps API 整合：**
1. **API 金鑰管理**：安全地管理 Google Maps API 金鑰
2. **前端整合**：使用 Google Places Autocomplete 提升用戶體驗
3. **後端驗證**：使用 Google Geocoding API 確保地址準確性
4. **成本控制**：設定合理的 API 調用限制

**餐廳顯示機制：**
1. **資料庫查詢優化**：在查詢時加入顯示條件
2. **前台頁面修改**：修改現有的餐廳顯示邏輯
3. **完成度計算**：實作餐廳資料完整度評估
4. **用戶介面設計**：設計直觀的完成度提醒

## 🔍 參考文檔

- `wordpress/functions.php`：核心功能函數，已整合餐廳直接加入功能、密碼驗證、Email 檢查
- `wordpress/restaurant-member-functions.php`：餐廳會員系統功能
- `wordpress/archive-restaurant.php`：餐廳列表頁面（需要修改加入顯示條件）
- `wordpress/single_restaurant.php`：單一餐廳頁面（需要修改加入顯示條件）
- `doc/ai_progress_byob.md`：詳細的開發進度記錄