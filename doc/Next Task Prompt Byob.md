### 📌 明日工作任務（2025-08-10）

**目標：完成一鍵註冊邀請系統及前端使用者體驗優化**

#### 1. 🎉 今日完成成果（2025-08-09）

**✅ 重大突破：一鍵註冊邀請系統基本建置完成**

**1.1 今日重大進展**

* 🔧 **邀請系統建置完成**：成功建立完整的一鍵註冊邀請功能
  - 文章發布自動觸發邀請郵件
  - 精美的 HTML 邀請郵件模板
  - 安全的 token 驗證機制
  - 7天有效期限制
* 🛠️ **註冊流程自動化**：完成無縫的註冊體驗
  - 自動攔截邀請連結
  - 註冊頁面顯示歡迎訊息
  - 自動設定餐廳業者角色
  - 自動關聯餐廳文章
* 📊 **後台診斷工具**：建立完整的系統監控機制
  - WordPress 後台診斷頁面（工具 → BYOB 診斷）
  - 系統狀態檢查
  - 邀請功能測試
  - 邀請統計資訊
* 🚧 **技術問題解決**：修復伺服器錯誤和相容性問題
  - 解決檔案路徑問題
  - 修復 session 處理機制
  - 優化函數載入邏輯
  - 成功恢復網站正常運作

#### 2. 🚨 優先任務：前端使用者體驗優化及邀請系統完善

**2.1 明日重點工作項目**

**🔴 最高優先級：前端使用者體驗優化**

1. **餐廳單頁功能改善**（預計 2 小時）
   ```php
   // 需修改的功能：
   - [ ] 新增「返回上一頁」按鈕
   - [ ] 官網連結功能檢查和修復  
   - [ ] 社群連結功能檢查和修復
   - [ ] 連結開啟方式優化（新分頁）
   ```

2. **邀請系統優化**（預計 1.5 小時）
   ```php
   // 需修改的功能：
   - [ ] 修改邀請郵件模板和內容
   - [ ] 優化郵件發送者資訊
   - [ ] 改善郵件視覺設計
   - [ ] 測試郵件傳送功能
   ```

3. **註冊連結修復**（預計 1 小時）
   ```php
   // 需檢查和修復：
   - [ ] 診斷「立即註冊會員」連結失效問題
   - [ ] 檢查 token 驗證邏輯
   - [ ] 測試完整註冊流程
   - [ ] 確認自動角色設定功能
   ```

**🟡 中等優先級：資料處理優化**

4. **Google 表單資料分欄處理**（預計 1.5 小時）
   ```javascript
   // 需修改的 Apps Script 功能：
   - [ ] 識別官網及社群連結欄位
   - [ ] 在轉換後資料庫格式中拆分為兩欄
   - [ ] 更新欄位映射邏輯
   - [ ] 測試資料轉換功能
   ```

**2.2 技術細節和實作方向**

**餐廳單頁功能改善技術細節**：
```php
// 需檢查的檔案位置：
- single-restaurant.php 或相關模板檔案
- functions.php 中的餐廳顯示邏輯
- ACF 欄位 'website' 和 'social_links' 的顯示邏輯

// 實作重點：
1. 新增返回按鈕：使用 JavaScript history.back() 或麵包屑導航
2. 連結檢查：確認 ACF 欄位值是否正確存取
3. 新分頁開啟：target="_blank" rel="noopener noreferrer"
```

**邀請郵件優化技術細節**：
```php
// 需修改的函數：byob_send_invitation_email()
// 位置：functions.php 約第 989 行

// 修改重點：
1. 郵件發送者名稱和地址
2. 郵件主旨和內容文案
3. CSS 樣式優化
4. 品牌一致性確保
```

**註冊連結診斷技術細節**：
```php
// 需檢查的功能：
1. byob_handle_invitation_registration() - 邀請攔截
2. byob_verify_invitation_token() - token 驗證  
3. WordPress 註冊頁面 URL 產生邏輯
4. Session 處理機制

// 檢查工具：使用後台診斷頁面（工具 → BYOB 診斷）
```

**資料分欄處理技術細節**：
```javascript
// 需修改的 Google Apps Script 檔案：
// c:\GitHubProjects\BYOB\wordpress\Apps script - 純淨版.js

// 修改重點：
1. convertFormToBYOBDatabase() 函數
2. 識別「餐廳網站或訂位連結」和「餐廳 Instagram 或 Facebook」
3. 拆分邏輯：分別儲存為 'website' 和 'social_links' 欄位
4. 更新欄位映射表
```

#### 3. 📋 明日工作時間分配

**3.1 建議時間安排**

- **上午（09:00-12:00）**：前端使用者體驗優化
  - 餐廳單頁功能改善（2小時）
  - 邀請郵件優化（1小時）

- **下午（13:00-16:00）**：邀請系統完善  
  - 註冊連結修復診斷（1小時）
  - Google 表單資料分欄處理（1.5小時）
  - 整體測試和驗證（0.5小時）

- **晚上（可選）**：文件更新和整理
  - 更新技術文件
  - 記錄解決方案

**3.2 成功標準**

- [ ] 餐廳單頁有「返回上一頁」按鈕且功能正常
- [ ] 官網和社群連結能正確顯示並在新分頁開啟
- [ ] 邀請郵件內容和視覺設計符合品牌要求
- [ ] 「立即註冊會員」連結能正常運作
- [ ] 註冊流程能正確設定餐廳業者角色
- [ ] Google 表單官網和社群連結能正確分欄處理
- [ ] 所有功能經過完整測試驗證

**3.3 風險控管**

- 🔴 **高風險**：註冊連結修復可能涉及複雜的 token 驗證邏輯
- 🟡 **中風險**：郵件模板修改需注意 HTML 相容性
- 🟢 **低風險**：前端 UI 改善相對簡單安全

#### 4. 📚 歷史進展記錄

**4.1 重要里程碑**

**2025-01-16 完成項目：**
* ✅ 一鍵註冊邀請系統基本架構建置
* ✅ 文章發布自動觸發邀請功能
* ✅ 安全的 token 驗證機制
* ✅ 後台診斷工具建立
* ✅ 伺服器錯誤修復和系統穩定化
* ✅ Google 表單自動生成餐廳草稿功能運作正常

**2025-01-17 待完成項目：**
* 🔄 餐廳單頁使用者體驗改善  
* 🔄 邀請郵件內容和視覺優化
* 🔄 註冊連結功能修復
* 🔄 Google 表單資料分欄處理

**4.2 過往技術解決記錄**

**已解決的重要技術問題：**

* **Google Apps Script 語法錯誤**：ES6+ 轉 ES5 相容性問題
* **ACF 欄位值格式不匹配**：中文值轉英文值映射問題  
* **WordPress REST API 參數缺失**：資料解析失敗導致空 payload
* **伺服器錯誤和檔案路徑**：require_once 路徑和 session 處理問題
* **邀請系統架構設計**：從邀請碼改為一鍵註冊連結方案

**技術堆疊和工具：**
- **前端**：WordPress + Flatsome 主題 + ACF
- **後端**：PHP + Google Apps Script + MySQL  
- **整合**：WordPress REST API + Google Sheets API
- **邀請系統**：Token-based 驗證 + 自動角色分配
- **監控**：WordPress 後台診斷工具

---

## 📝 附註

**專案檔案結構參考：**
```
c:\GitHubProjects\BYOB\
├── wordpress\
│   ├── functions.php (主要邏輯)
│   ├── invitation-handler.php (邀請處理)
│   └── Apps script - 純淨版.js (Google Apps Script)
└── doc\
    ├── Next Task Prompt Byob.md (本檔案)
    └── README.md (專案概述)
```

**重要提醒：**
- 修改前請備份檔案
- 使用後台診斷工具進行測試
- 所有變更都有詳細的錯誤日誌記錄
- 如遇問題可參考 `functions.php` 中的診斷頁面