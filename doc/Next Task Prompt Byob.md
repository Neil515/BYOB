# 🎯 BYOB 專案工作規劃與進度追蹤

## 📅 今日工作完成（2025-08-19）

### ✅ 已完成項目：

#### 1. 餐廳直接加入功能問題解決
- **會員狀態問題解決**：
  - 問題：直接註冊的餐廳在後台顯示"未註冊"狀態
  - 解決：修改 `functions.php` 中的 `byob_handle_restaurant_registration` 函數
  - 實作：添加用戶創建/角色分配邏輯，建立餐廳與用戶的關聯
  - 結果：後台會員管理頁面正確顯示"已註冊"狀態

#### 2. 用戶登入密碼問題解決
- **問題描述**：直接註冊的用戶無法登入（無密碼）
- **解決方案**：在註冊表單中添加密碼設定欄位
- **實作內容**：
  - 表單新增：密碼、確認密碼欄位
  - 驗證邏輯：密碼匹配檢查、最小長度驗證
  - 用戶體驗：用戶自行設定密碼，無需記住隨機密碼
- **結果**：用戶可以正常登入系統

#### 3. Contact Form 7 (CF7) 表單設計
- **表單欄位設定**：
  - 餐廳名稱：`restaurant_name`（對應 WordPress post_title）
  - 聯絡人姓名：`contact_person`
  - 聯絡Email：`contact_email`
  - 聯絡電話：`restaurant_phone`
  - 設定密碼：`user_password`
  - 確認密碼：`confirm_password`
  - 餐廳類型：`restaurant_type`（核取方塊群組）
  - 行政區：`district`（下拉選單）
  - 餐廳地址：`restaurant_address`
  - 餐廳網站：`website_url`
  - 社群連結：`social_media_links`
  - 是否收開瓶費：`is_charged`（選項按鈕）
  - 開瓶費說明：`corkage_fee`（單行文字）
  - 酒器設備：`equipment`（核取方塊群組）
  - 是否提供開酒服務：`open_bottle_service`（下拉選單）
  - 開酒服務其他說明：`open_bottle_service_other_note`（單行文字）
  - 是否為餐廳負責人：`is_owner`（下拉選單）

#### 4. CF7 與 ACF 欄位對應規劃
- **WordPress 內建欄位對應**：
  - `restaurant_name` → `post_title`（餐廳名稱）
- **ACF 欄位對應**：
  - `contact_person` → `contact_person`
  - `contact_email` → `contact_email`
  - `restaurant_phone` → `restaurant_phone`
  - `restaurant_type` → `restaurant_type`
  - `district` → `district`
  - `restaurant_address` → `restaurant_address`
  - `website_url` → `website_url`
  - `social_media_links` → `social_media_links`
  - `is_charged` → `is_charged`
  - `corkage_fee` → `corkage_fee`
  - `equipment` → `equipment`
  - `open_bottle_service` → `open_bottle_service`
  - `open_bottle_service_other_note` → `open_bottle_service_other_note`
  - `is_owner` → `is_owner`

### 🔧 修改的檔案：
1. `wordpress/functions.php` - 修正會員狀態和密碼問題
2. `wordpress/restaurant-registration-functions.php` - 移除 is_owner 選擇欄位

### ⚠️ 待解決問題：

#### 1. CF7 條件式欄位邏輯（優先級：高）
- **開瓶費條件式欄位**：
  - 選擇"酌收"時顯示金額輸入欄位
  - 選擇"其他"時顯示說明輸入欄位
- **開酒服務條件式欄位**：
  - 選擇"其他"時顯示說明輸入欄位

#### 2. CF7 表單實作（優先級：高）
- 完成所有欄位的 CF7 設定
- 測試表單提交功能
- 驗證資料正確性

---

## 🚀 明日工作規劃（2025-08-20）

### 🎯 主要目標：
**完成 CF7 表單實作，處理條件式欄位邏輯，修改相關程式檔案**

### 📋 工作項目：

#### 1. CF7 密碼欄位建立（優先級：最高）
- **密碼欄位設定**：
  - 在 CF7 中建立 `user_password` 欄位（密碼）
  - 在 CF7 中建立 `confirm_password` 欄位（確認密碼）
  - 設定適當的驗證規則（最小長度、必填等）
  - 測試密碼欄位的顯示和驗證功能
- **欄位類型**：使用 CF7 的「密碼欄位」類型
- **驗證規則**：密碼最小長度 6 字元，必填欄位

#### 2. CF7 條件式欄位邏輯實作（優先級：高）
- **開瓶費條件式欄位**：
  - 實作 JavaScript 控制邏輯
  - 根據 `is_charged` 選擇顯示對應欄位
  - 測試顯示/隱藏功能
- **開酒服務條件式欄位**：
  - 實作 JavaScript 控制邏輯
  - 根據 `open_bottle_service` 選擇顯示說明欄位
  - 測試顯示/隱藏功能

#### 2. CF7 表單處理函數實作（優先級：高）
- **修改 `functions.php`**：
  - 新增 `byob_handle_cf7_restaurant_registration` 函數
  - 處理 CF7 表單提交
  - 建立餐廳文章和用戶帳戶
  - 更新 ACF 欄位資料
- **資料驗證**：
  - 必填欄位檢查
  - 密碼匹配驗證
  - 重複餐廳檢查
- **錯誤處理**：
  - 表單驗證錯誤提示
  - 伺服器錯誤處理

#### 3. ACF 欄位檢查與調整（優先級：中）
- **檢查現有 ACF 欄位**：
  - 確認所有 CF7 欄位都有對應的 ACF 欄位
  - 檢查欄位類型是否正確
  - 驗證欄位名稱一致性
- **新增必要欄位**：
  - 如果缺少對應欄位，建立新的 ACF 欄位
  - 設定適當的欄位類型和驗證規則

#### 4. 表單測試與除錯（優先級：中）
- **功能測試**：
  - 表單提交功能
  - 條件式欄位顯示/隱藏
  - 資料儲存正確性
  - 用戶帳戶建立
- **錯誤處理測試**：
  - 必填欄位驗證
  - 密碼匹配驗證
  - 重複資料檢查
- **用戶體驗測試**：
  - 表單填寫流程
  - 錯誤提示清晰度
  - 成功頁面顯示

### 🛠️ 技術重點：

#### CF7 條件式欄位：
- JavaScript 事件監聽
- DOM 元素顯示/隱藏控制
- 表單驗證邏輯
- 用戶體驗優化

#### PHP 處理函數：
- CF7 提交資料獲取
- 餐廳文章建立
- 用戶帳戶管理
- ACF 欄位更新
- 錯誤處理機制

#### ACF 欄位管理：
- 欄位名稱一致性
- 欄位類型正確性
- 驗證規則設定
- 資料對應關係

### 📊 進度追蹤：

#### 已完成功能：
- ✅ 餐廳直接加入功能架構
- ✅ 會員狀態問題解決
- ✅ 用戶登入密碼問題解決
- ✅ CF7 表單欄位設計
- ✅ CF7 與 ACF 欄位對應規劃

#### 進行中功能：
- 🔄 CF7 條件式欄位邏輯
- 🔄 CF7 表單處理函數
- 🔄 ACF 欄位檢查與調整

#### 待開發功能：
- 📝 CF7 表單完整測試
- 📝 用戶體驗優化
- 📝 錯誤處理完善

---

## 🎯 整體專案目標

### 短期目標（本週）：
1. 完成 CF7 表單實作
2. 解決條件式欄位邏輯
3. 完善整個註冊流程

### 中期目標（下週）：
1. 系統整體穩定性檢查
2. 使用者體驗優化
3. 功能迭代優化

### 長期目標（本月）：
1. 完整系統測試
2. 使用者回饋收集
3. 功能迭代優化

---

## 📝 注意事項

### 技術考量：
- 保持程式碼簡潔可靠
- 優先考慮使用者體驗
- 確保系統穩定性
- 遵循 WordPress 最佳實踐

### 品質要求：
- 功能完整且穩定
- 使用者介面友善
- 錯誤處理完善
- 響應式設計支援

### 測試重點：
- 各項功能正常運作
- 錯誤情況處理
- 不同裝置相容性
- 使用者操作流程

---

## 🏆 今日重要成就

**CF7 表單設計完成**：成功設計完整的餐廳註冊表單，包含所有必要欄位和條件式邏輯規劃。為餐廳業者提供了更專業、更易用的註冊介面。

**技術問題解決**：成功解決會員狀態顯示和用戶登入密碼問題，確保餐廳直接註冊功能的完整性和穩定性。

**欄位對應規劃**：完成 CF7 與 ACF 欄位的完整對應規劃，為後續實作奠定了堅實的基礎。