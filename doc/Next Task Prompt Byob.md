# 🗓️ BYOB 專案 - 下次任務安排（2025-08-15）

## 📋 今日完成項目（2025-08-14）

### ✅ 已完成：
1. **第一階段：自定義 WooCommerce 會員選單（100% 完成）**
   - ✅ 隱藏不相關選單項目（訂單、下載次數、地址、Wishlist）
   - ✅ 移除重複的「餐廳控制台」選單項目
   - ✅ 建立專用選單結構：控制台 → 餐廳資料編輯 → 照片管理 → 菜單管理 → 登出
   - ✅ 完全覆蓋預設 WooCommerce 控制台內容
   - ✅ 餐廳業者專用控制台頁面建置完成

2. **第二階段：餐廳資料管理功能（重大進展）**
   - ✅ 餐廳資料編輯表單設計完成
   - ✅ LOGO 上傳功能程式碼完成
   - ✅ 表單驗證和提交處理完成
   - ✅ 建立 `restaurant-profile.php` WooCommerce 模板檔案
   - ✅ 上傳到伺服器 `/wp-content/themes/flatsome-child/woocommerce/myaccount/`
   - ✅ **解決 404 錯誤問題（100% 完成）**
   - ✅ **左側選單正常顯示**
   - ✅ **新增欄位正常顯示（餐廳類型、開瓶費、酒器設備、開酒服務、官方網站/社群連結）**

3. **第三階段：ACF 資料載入問題解決（重大突破）**
   - ✅ **解決 ACF 欄位資料不匹配問題（100% 完成）**
   - ✅ **修正餐廳類型欄位：將英文鍵值改為中文值（台式、法式、義式等）**
   - ✅ **修正酒器設備欄位：將英文鍵值改為中文值（酒杯、開瓶器、冰桶等）**
   - ✅ **修正開酒服務欄位：從選項按鈕改為下拉選單，符合 ACF 欄位類型**
   - ✅ **新增開酒服務其他說明欄位：條件式顯示，當選擇「其他」時出現**
   - ✅ **新增除錯資訊顯示：在開發環境顯示 ACF 欄位載入狀態**
   - ✅ **新增 JavaScript 互動功能：動態顯示/隱藏其他說明欄位**

4. **程式碼優化**
   - ✅ 停用 YITH WooCommerce Wishlist 外掛
   - ✅ 簡化選單過濾器邏輯
   - ✅ 移除複雜的 Wishlist 隱藏程式碼
   - ✅ 優化快速操作按鈕樣式（使用 `rgba(139, 38, 53, 0.8)` 顏色）

---

## 🚨 今日遇到的問題（已解決）

### 1. **404 錯誤問題（✅ 已解決）**
**問題描述：** 所有選單項目（除了控制台和登出）都顯示 404 錯誤
**解決方案：** 使用 `template_include` 鉤子強制載入模板，並最終改用 `woocommerce_account_content` 鉤子

**解決過程：**
- ✅ 建立 WooCommerce 模板檔案
- ✅ 註冊自定義端點
- ✅ 重新整理永久連結
- ✅ 檢查檔案權限（664，正確）
- ✅ 使用 `template_include` 鉤子強制載入（解決404，但左側選單消失）
- ✅ 改用 `woocommerce_account_content` 鉤子（最終解決方案）

**最終解決方案：**
```php
function byob_load_restaurant_profile_content() {
    global $wp_query;
    
    if (is_account_page() && isset($wp_query->query_vars['restaurant-profile'])) {
        remove_action('woocommerce_account_content', 'woocommerce_account_content', 10);
        
        $template_path = get_stylesheet_directory() . '/woocommerce/myaccount/restaurant-profile.php';
        
        if (file_exists($template_path)) {
            include $template_path;
        }
    }
}

add_action('woocommerce_account_content', 'byob_load_restaurant_profile_content', 5);
```

### 2. **左側選單消失問題（✅ 已解決）**
**問題描述：** 使用 `template_include` 鉤子後，左側選單消失
**解決方案：** 改用 `woocommerce_account_content` 鉤子，只替換內容區域，保持頁面結構完整

### 3. **重複內容區塊問題（✅ 已解決）**
**問題描述：** 頁面出現上下兩個編輯區塊
**解決方案：** 使用 `remove_action` 移除 WooCommerce 預設內容，使用優先級 5 確保在預設內容之前執行

### 4. **ACF 欄位資料不匹配問題（✅ 已解決）**
**問題描述：** 表單選項值與 ACF 欄位值不匹配，導致資料無法正確載入
**根本原因：** 表單使用英文鍵值（如 'taiwanese'），但 ACF 儲存中文值（如 '台式'）
**解決方案：** 將所有表單選項的鍵值改為中文，與 ACF 儲存值完全一致

**修正的欄位：**
- **餐廳類型**：`'taiwanese' => '台式'` → `'台式' => '台式'`
- **酒器設備**：`'wine_glass' => '酒杯'` → `'酒杯' => '酒杯'`

### 5. **開酒服務欄位類型不匹配（✅ 已解決）**
**問題描述：** ACF 欄位類型是「選取」，但表單使用「選項按鈕」
**解決方案：** 將表單改為下拉選單，並新增條件式「其他說明」欄位

**新增功能：**
- 當選擇「是」時：顯示「✅ 提供開酒服務」
- 當選擇「否」時：顯示「❌ 未提供開酒服務」
- 當選擇「其他」時：顯示輸入欄位供填寫說明

---

## 🎯 明天任務（2025-08-15）：完善餐廳資料編輯頁面

### 🔴 最高優先級：餐廳資料編輯頁面細部修改

#### 1. 表單樣式和佈局優化（預計 1.5 小時）
**目標：** 改善表單的外觀和用戶體驗

**實作內容：**
- [ ] **表單佈局優化**
  - 調整欄位間距和對齊
  - 改善響應式設計
  - 優化 checkbox 和 radio button 的排列
  - 統一所有欄位的樣式風格

- [ ] **視覺效果優化**
  - 改善 hover 和 focus 狀態
  - 優化按鈕樣式和互動效果
  - 統一顏色主題（使用 `rgba(139, 38, 53, 0.8)` 主色調）
  - 改善表單區塊的視覺層次

#### 2. 表單驗證和錯誤處理（預計 1 小時）
**目標：** 改善表單的驗證和錯誤提示

**實作內容：**
- [ ] **前端驗證優化**
  - 改善 checkbox 數量限制的提示（餐廳類型最多3個）
  - 添加必填欄位的視覺提示
  - 優化表單提交前的驗證邏輯
  - 新增即時驗證反饋

- [ ] **後端錯誤處理**
  - 改善錯誤訊息的顯示樣式
  - 添加成功更新的確認訊息
  - 優化 LOGO 上傳的錯誤處理
  - 新增資料更新進度提示

#### 3. 功能測試和除錯（預計 0.5 小時）
**目標：** 確保所有功能正常運作

**測試項目：**
- [ ] **表單提交功能**
  - 測試所有欄位的資料儲存
  - 驗證 LOGO 上傳功能
  - 檢查資料更新後的顯示
  - 測試開酒服務欄位的條件式顯示

- [ ] **用戶體驗測試**
  - 測試表單的易用性
  - 檢查錯誤處理的用戶友好性
  - 驗證響應式設計
  - 測試 JavaScript 互動功能

### 🟡 中等優先級：新增其他兩個餐廳業者後台頁面

#### 4. 照片管理頁面（預計 2 小時）
**目標：** 建立餐廳照片管理功能

**實作內容：**
- [ ] **頁面結構設計**
  - 建立 `restaurant-photos.php` 模板檔案
  - 設計照片上傳和管理介面
  - 實作照片庫顯示功能
  - 新增照片刪除和排序功能

- [ ] **功能實作**
  - 照片上傳處理（支援多種格式）
  - 照片縮圖生成
  - 照片庫管理（新增、刪除、排序）
  - 照片分類管理（餐廳環境、美食、活動等）

#### 5. 菜單管理頁面（預計 2 小時）
**目標：** 建立餐廳菜單管理功能

**實作內容：**
- [ ] **頁面結構設計**
  - 建立 `restaurant-menu.php` 模板檔案
  - 設計菜單項目管理介面
  - 實作菜單分類管理
  - 新增菜單項目編輯功能

- [ ] **功能實作**
  - 菜單分類管理（新增、編輯、刪除）
  - 菜單項目管理（名稱、價格、描述、圖片）
  - 菜單排序和顯示設定
  - 菜單匯入/匯出功能

---

## 🛠️ 技術實作重點

### 📁 需要修改的檔案：
1. `restaurant-profile.php` - 樣式優化和功能完善
2. `restaurant-member-functions.php` - 新增照片和菜單管理功能
3. `functions.php` - 新增頁面載入鉤子

### 🔧 需要解決的技術問題：
1. **表單樣式和佈局**
   - 優化響應式設計
   - 改善用戶體驗
   - 統一視覺風格
   - 優化互動效果

2. **照片管理功能**
   - 檔案上傳處理
   - 圖片處理和縮圖
   - 資料庫儲存結構
   - 前端顯示和互動

3. **菜單管理功能**
   - 菜單資料結構設計
   - 分類管理邏輯
   - 菜單項目 CRUD 操作
   - 前端編輯介面

### 📊 預期成果：
1. ✅ 餐廳資料編輯頁面樣式和功能完善
2. ✅ 照片管理頁面功能完整
3. ✅ 菜單管理頁面功能完整
4. ✅ 三個後台頁面風格統一，用戶體驗一致

---

## 📝 工作流程

### 上午（9:00-12:00）：
1. 餐廳資料編輯頁面樣式優化（1.5小時）
2. 表單驗證和錯誤處理改善（1小時）
3. 功能測試和除錯（0.5小時）

### 下午（13:00-17:00）：
1. 照片管理頁面開發（2小時）
2. 菜單管理頁面開發（2小時）

---

## 🚨 注意事項

1. **保持現有功能正常**：不要破壞已經解決的 ACF 資料載入問題
2. **風格一致性**：三個後台頁面要保持統一的視覺風格和用戶體驗
3. **逐步開發**：每次完成一個頁面後都要測試，確保功能正常
4. **記錄開發過程**：詳細記錄每個功能的實作方法，方便後續維護

---

## 🔍 問題診斷清單

### 餐廳資料編輯頁面檢查：
- [ ] **樣式優化**
  - [ ] 表單佈局美觀易用
  - [ ] 響應式設計正常
  - [ ] 顏色主題統一
  - [ ] 互動效果流暢

- [ ] **功能完善**
  - [ ] 所有 ACF 欄位資料正確載入
  - [ ] 表單驗證邏輯完善
  - [ ] 錯誤處理用戶友好
  - [ ] JavaScript 互動正常

### 新頁面功能測試：
- [ ] **照片管理頁面**
  - [ ] 照片上傳功能正常
  - [ ] 照片庫顯示正確
  - [ ] 照片管理操作正常
  - [ ] 響應式設計正常

- [ ] **菜單管理頁面**
  - [ ] 菜單分類管理正常
  - [ ] 菜單項目 CRUD 正常
  - [ ] 菜單排序功能正常
  - [ ] 前端編輯介面友好

---

## 📊 進度總結

### 已完成階段：
- ✅ **第一階段：自定義 WooCommerce 會員選單（100%）**
- ✅ **第二階段：餐廳資料管理功能（95%）**
  - ✅ 404 錯誤解決（100%）
  - ✅ 左側選單正常顯示（100%）
  - ✅ 新增欄位正常顯示（100%）
  - ✅ ACF 資料完整帶入（100%）
  - ⏳ 細部修改和優化（待完成）
- ⏳ **第三階段：其他後台頁面開發（0%）**
  - ⏳ 照片管理頁面（待開發）
  - ⏳ 菜單管理頁面（待開發）

### 明天重點：
1. **完善餐廳資料編輯頁面** - 樣式優化、功能完善、用戶體驗提升
2. **開發照片管理頁面** - 照片上傳、管理、分類功能
3. **開發菜單管理頁面** - 菜單分類、項目管理、編輯功能

---

*最後更新：2025-01-07*
*負責人：[您的姓名]*
*明天重點：完善餐廳資料編輯頁面，開發照片管理和菜單管理頁面*